<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WebMarCoral | Panel Admin</title>

  <style>
    :root{
      --primary:#2563eb;
      --danger:#dc2626;
      --success:#16a34a;
      --bg:#f4f6f9;
      --card:#ffffff;
      --border:#e5e7eb;
      --muted:#6b7280;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg);
      color:#111;
    }

    header{
      background:#111827;
      color:#fff;
      padding:18px 24px;
    }

    header h1{
      margin:0;
      font-size:20px;
    }

    header p{
      margin:6px 0 0;
      font-size:13px;
      opacity:.85;
    }

    main{
      max-width:1100px;
      margin:24px auto;
      padding:0 16px;
    }

    .card{
      background:var(--card);
      border-radius:10px;
      padding:18px;
      margin-bottom:22px;
      box-shadow:0 4px 12px rgba(0,0,0,.08);
    }

    .card h2{
      margin:0 0 10px;
      font-size:16px;
    }

    .hint{
      font-size:13px;
      color:var(--muted);
      margin-bottom:10px;
    }

    label{
      display:block;
      font-size:13px;
      margin-top:12px;
    }

    input, textarea, select{
      width:100%;
      padding:8px;
      margin-top:4px;
      border-radius:6px;
      border:1px solid var(--border);
      font-size:14px;
    }

    button{
      padding:9px 16px;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
    }

    .btn-primary{ background:var(--primary); color:#fff; }
    .btn-danger{ background:var(--danger); color:#fff; }
    .btn-secondary{ background:#e5e7eb; }

    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    .status{
      margin-top:10px;
      font-size:13px;
    }

    .ok{ color:var(--success); }
    .bad{ color:var(--danger); }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
    }

    th, td{
      border-bottom:1px solid var(--border);
      padding:8px;
      font-size:14px;
      text-align:left;
    }

    th{
      background:#f3f4f6;
    }

    .actions button{
      margin-right:6px;
      margin-top:4px;
    }

    .step{
      display:inline-block;
      background:#eef2ff;
      color:#3730a3;
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      margin-bottom:8px;
    }
  </style>
</head>

<body>

<header>
  <h1>WebMarCoral – Panel de Administración</h1>
  <p>Diseñado para que cualquier persona pueda usarlo sin conocimientos técnicos</p>
</header>

<main>

  <!-- PASO 1 -->
  <div class="card">
    <div class="step">PASO 1</div>
    <h2>Conectar con el sistema</h2>
    <div class="hint">
      Aquí solo pegas el token y presionas “Conectar”.  
      Si ves un mensaje verde, todo está listo.
    </div>

    <label>Dirección del sistema (API)
      <input id="apiUrl" value="http://localhost:3001">
    </label>

    <label>Token de administrador
      <input id="token" placeholder="ADMIN_TOKEN">
    </label>

    <button class="btn-primary" onclick="connect()">Conectar</button>

    <div id="status" class="status"></div>
  </div>

  <!-- PASO 2 -->
  <div class="card">
    <div class="step">PASO 2</div>
    <h2>Crear producto</h2>
    <div class="hint">
      Completa solo lo básico.  
      Puedes editar o ocultar el producto después.
    </div>

    <label>Nombre del producto
      <input id="name">
    </label>

    <label>Precio
      <input id="price" type="number" step="0.01">
    </label>

    <label>Categoría
      <input id="category">
    </label>

    <label>Descripción
      <textarea id="description"></textarea>
    </label>

    <label>Imagen (URL o ruta)
      <input id="image">
    </label>

    <label>¿Mostrar en la tienda?
      <select id="active">
        <option value="true">Sí, visible</option>
        <option value="false">No, oculto</option>
      </select>
    </label>

    <button class="btn-primary" onclick="createProduct()">Crear producto</button>
  </div>

  <!-- PASO 3 -->
  <div class="card">
    <div class="step">PASO 3</div>
    <h2>Productos existentes</h2>
    <div class="hint">
      “Oculto” significa que NO aparece en la tienda.  
      Puedes mostrarlo cuando quieras.
    </div>

    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="products"></tbody>
    </table>
  </div>

</main>

<script>
  let API = "";
  let TOKEN = "";

  function headers(){
    return {
      "Content-Type":"application/json",
      "x-admin-token": TOKEN
    };
  }

  async function connect(){
    API = apiUrl.value;
    TOKEN = token.value;

    const status = document.getElementById("status");
    status.textContent = "Conectando…";
    status.className = "status";

    try{
      const res = await fetch(API + "/api/admin/products", {
        headers: headers()
      });

      if(!res.ok){
        status.textContent = "❌ Token incorrecto o sistema apagado";
        status.classList.add("bad");
        return;
      }

      status.textContent = "✅ Conectado correctamente";
      status.classList.add("ok");

      const data = await res.json();
      renderProducts(data);

    }catch{
      status.textContent = "❌ No se pudo conectar al sistema";
      status.classList.add("bad");
    }
  }

  function renderProducts(list){
    const tbody = document.getElementById("products");
    tbody.innerHTML = "";

    list.forEach(p=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p.name}</td>
        <td>$${p.price}</td>
        <td>${p.active ? "Visible" : "Oculto"}</td>
        <td class="actions">
          <button class="btn-secondary" onclick="toggleActive('${p.id}', ${!p.active})">
            ${p.active ? "Ocultar" : "Mostrar"}
          </button>
          <button class="btn-danger" onclick="deleteProduct('${p.id}')">
            Borrar
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  async function createProduct(){
    if(!name.value || !price.value){
      alert("Nombre y precio son obligatorios");
      return;
    }

    const payload = {
      name: name.value,
      price: Number(price.value),
      category: category.value,
      description: description.value,
      image: image.value,
      active: active.value === "true"
    };

    await fetch(API + "/api/admin/products", {
      method:"POST",
      headers: headers(),
      body: JSON.stringify(payload)
    });

    connect();
  }

  async function toggleActive(id, value){
    await fetch(API + "/api/admin/products/" + id, {
      method:"PATCH",
      headers: headers(),
      body: JSON.stringify({ active:value })
    });

    connect();
  }

  async function deleteProduct(id){
    if(!confirm("¿Seguro que deseas borrar este producto?")) return;

    await fetch(API + "/api/admin/products/" + id, {
      method:"DELETE",
      headers: headers()
    });

    connect();
  }
</script>

</body>
</html>
